# Project overview
Use this guide to build backend for the web app of cartoon maker

# Tech stack
- We will use Next.js, Supabase, Clerk

# Tables & buckets already created
Supabase storage Bucket: "cartoons"

TABLE cartoons (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  image_url TEXT NOT NULL,
  prompt TEXT NOT NULL,
  likes_count NUMERIC DEFAULT 0,
  creator_user_id TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

TABLE profiles (
  user_id TEXT PRIMARY KEY,
  credits INTEGER DEFAULT 3 NOT NULL,
  tier TEXT NOT NULL DEFAULT 'free' CHECK (tier IN ('free', 'pro')),
  stripe_customer_id TEXT,
  stripe_subscription_id TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

TABLE likes (
  like_id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  cartoon_id BIGINT,
  liked_by TEXT,
  status INTEGER DEFAULT 1 NOT NULL,
  creator_user_id TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

# Requirements
1. Create user to user table
   1. After a user signin via clerk, we should get the userId from clerk, and check if this userId exist in 'profiles' table, matching "user_id"
   2. if the user doesnt exist, then create a user in 'profiles' table
   3. if the user exist already, then proceed, and pass on user_id to functions like generate cartoons
2. Upload cartoon to "cartoons" supabase storage bucket;
   1. When user generating a cartoon, upload the cartoon image file returned from Replicate to supabase "cartoons" storage bucket
   2. Add the image url to the "cartoons" data table as "image_url", and creator_user_id to be the actual user_id
3. Display all images in cartoongrid
   1. Cartoon grid should fetch and display all images from "cartoons" data table
   2. when a new cartoon is generated, the cartoongrid should be updated automatically to add the new cartoon to the grid
4. Likes interaction
   1. When user check on 'like' button, the num_likes should increase on the 'cartoons' table and it should create/update an entry in the 'likes' table with status = 1
   2. when user un-check 'like' button, the num_likes should decrease on the 'cartoons' table and it should update an entry in the 'likes' table with status = 1
5. Do not touch middleware.ts

# Documentations
## Example of uploading files to supabase storage
import { createClient } from '@supabase/supabase-js'

// Create Supabase client
const supabase = createClient('your_project_url', 'your_supabase_api_key')

// Upload file using standard upload
async function uploadFile(file) {
  const { data, error } = await supabase.storage.from('bucket_name').upload('file_path', file)
  if (error) {
    // Handle error
  } else {
    // Handle success
  }
}

